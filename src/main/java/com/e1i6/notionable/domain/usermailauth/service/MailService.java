package com.e1i6.notionable.domain.usermailauth.service;import java.io.UnsupportedEncodingException;import java.security.SecureRandom;import javax.mail.MessagingException;import javax.mail.internet.InternetAddress;import javax.mail.internet.MimeMessage;import org.springframework.core.env.Environment;import org.springframework.mail.javamail.JavaMailSender;import org.springframework.stereotype.Service;import org.thymeleaf.context.Context;import org.thymeleaf.spring5.SpringTemplateEngine;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;@Service@RequiredArgsConstructor@Slf4jpublic class MailService {	private final Environment env;	private final JavaMailSender javaMailSender;	private final SpringTemplateEngine templateEngine;	private static String senderEmail;	private static final int AUTH_CODE_LENGTH = 5;	private static String authCode;	public static void generateRandomCode() {		String characters = "0123456789";		// 랜덤 코드 생성		SecureRandom random = new SecureRandom();		StringBuilder sb = new StringBuilder(AUTH_CODE_LENGTH);		for (int i = 0; i < AUTH_CODE_LENGTH; i++) {			int randomIndex = random.nextInt(characters.length());			char randomChar = characters.charAt(randomIndex);			sb.append(randomChar);		}		authCode = sb.toString();	}	public MimeMessage createMail(String mail) throws MessagingException, UnsupportedEncodingException {		generateRandomCode();		MimeMessage message = javaMailSender.createMimeMessage();		senderEmail = env.getProperty("spring.mail.username");		message.setFrom(new InternetAddress(senderEmail, "notionable"));		log.info("debug2");		message.setRecipients(MimeMessage.RecipientType.TO, mail);		log.info("debug3");		message.setSubject("[notionable] 이메일 인증");		String body = "";		body += "<h3>" + "요청하신 인증코드입니다." + "</h3>";		body += "<h1>" + authCode + "</h1>";		body += "<h3>" + "감사합니다." + "</h3>";		log.info("debug4");		message.setText(body, "UTF-8", "html");		return message;	}	//실제 메일 전송	public String sendEmail(String toEmail) throws MessagingException, UnsupportedEncodingException {		//메일전송에 필요한 정보 설정		MimeMessage emailForm = createMail(toEmail);		//실제 메일 전송		javaMailSender.send(emailForm);		return authCode; //인증 코드 반환	}	//타임리프를 이용한 context 설정	public String setContext(String code) {		Context context = new Context();		context.setVariable("code", code);		return templateEngine.process("mail", context); //mail.html	}}